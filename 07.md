# íŒŒì´í”„ì™€ ìœ íš¨ì„± ê²€ì‚¬

íŒŒì´í”„(Pipe)ëŠ” ìš”ì²­ì´ ë¼ìš°í„° í•¸ë“¤ëŸ¬ë¡œ ì „ë‹¬ë˜ê¸° ì „, ìš”ì²­ ê°ì²´ë¥¼ ë³€í™˜í•  ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì œê³µí•œë‹¤. ë§ˆì¹˜ ë¯¸ë“¤ì›¨ì–´ì²˜ëŸ¼ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.

ë¯¸ë“¤ì›¨ì–´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í• ë„ë¡ í•  ìˆ˜ëŠ” ì—†ë‹¤. ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì—†ê¸°ë•Œë¬¸. (E.g., í˜„ì¬ ìš”ì²­ì´ ì–´ë–¤ í•¸ë“¤ëŸ¬ì—ì„œ ìˆ˜í–‰ì¤‘ì¸ê°€? ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆëŠ”ê°€? ë“±)

íŒŒì´í”„ì˜ ì‚¬ìš©ëª©ì ì€ ì•„ë˜ì™€ ê°™ë‹¤:

- ë³€í™˜(_transformation_): ì…ë ¥ ë°ì´í„°ë¥¼ ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    - E.g., `/users/user/1`ì˜ ê²½ë¡œ ë§¤ê°œë³€ìˆ˜ ë¬¸ìì—´ `1`ì„ ì •ìˆ˜ë¡œ ë³€í™˜
- ìœ íš¨ì„± ê²€ì‚¬(_validation_): ì…ë ¥ ë°ì´í„° ê²€ì¦, ì˜ˆì™¸ì²˜ë¦¬

`@nest/common` íŒ¨í‚¤ì§€ì—ëŠ” ì—¬ëŸ¬ ë‚´ì¥ íŒŒì´í”„ê°€ ìˆë‹¤:

- `ValidationPipe` (8ì¥ì—ì„œ ì‚´í´ë´„)
- `ParseIntPipe`
- `ParseBoolPipe`
- `ParseArrayPipe`
- `ParseUUIDPipe`
- `DefaultValuePipe`

ìƒê¸° ì˜ˆì‹œì™€ ê°™ì´ ë§¤ë²ˆ ë§¤ê°œë³€ìˆ˜ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ëŠ” ì¤‘ë³µì½”ë“œë¥¼ ì—†ì•¨ ìˆ˜ ìˆë‹¤. ì•„ë˜ëŠ” ì‚¬ìš©ë¡€:

> `users.controllers.ts`

```ts
@Get(':id')
findOne(@Param('id', ParseIntPipe) id: number) {  // [1]
  return this.usersService.findOne(id);
}
```

[1]: ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ íŒŒì´í”„ë¥¼ ë„˜ê²¨, ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸(`ExecutionContext`)ì— ë°”ì¸ë”©ì„ í•  ìˆ˜ ìˆë‹¤

ì´ìƒí•˜ê²Œ ë³´ë‚´ë©´ ì•„ë˜ì™€ ê°™ì´ ê±¸ëŸ¬ì¤€ë‹¤:

```shell
â¯ curl --location 'http://localhost:3000/users/ã„´ã„¹'
{"message":"Validation failed (numeric string is expected)","error":"Bad Request","statusCode":400}
```

ì‘ë‹µê°’ì˜ HTTP status code ë˜í•œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” Pipeë‹¨ì—ì„œ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆë‹¤.

> `users.controllers.ts`

```ts
@Get('/:id')
async getUserInfo(
@Param(
    'id',
    new ParseIntPipe({ errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE }),
)
userId: string,
): Promise<UserInfo> {
return await this.usersService.getUserInfo(userId);
}
```

```shell
â¯ curl --location 'http://localhost:3000/users/ã„´'
{"message":"Validation failed (numeric string is expected)","error":"Not Acceptable","statusCode":406}
```

`DefaultValuePipe`ëŠ” ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ìƒëµëœ ìš”ì²­ì˜ ê¸°ë³¸ê°’ ì„¤ì •ì— í™œìš©í•  ìˆ˜ ìˆë‹¤. ì˜¤í”„ì…‹ ê¸°ë°˜ í˜ì´ì§• ì‚¬ìš© ì‹œ, ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì˜ ê¸°ë³¸ê°’ ì‚¬ìš©ë¡€:

```ts
@Get()
findAll(
  @Query('offset', new DefaultValuePipe(0), ParseIntPipe) offset: number,
  @Query('limit', new DefaultValuePipe(0), ParseIntPipe) limit: number,
) {
  return this.usersService.findAll();
}
```

## 7.2 íŒŒì´í”„ì˜ ë‚´ë¶€ êµ¬í˜„ ì´í•´í•˜ê¸°

`ValidationPipe` í™œìš©ë²•ì„ ì‚´í´ë³´ì. ì§ì ‘ ë§Œë“¤ì–´ë³¼ ì˜ˆì •ì´ë‹¤.

1. `PipeTransform` ì„ ìƒì†í•œë‹¤
2. `@Injectable` ë°ì½”ë ˆì´í„°ë¥¼ ë¶™ì¸ë‹¤

```ts
import { PipeTransform, Injectable, ArgumentMetadata } from '@nestjs/common';

@Injectable                                                 // [2]
export class ValidationPipe implements PipeTransform {      // [1]
  transform(value: any, metadata: ArgumentData) {
    console.log(metadata);
    return value;
  }
}
```

PipeTransformì˜ ì›í˜•ì€ ì•„ë˜ì™€ ê°™ë‹¤. ([ì°¸ê³ ë§í¬](https://github.com/nestjs/nest/blob/e36f04c51eb5c2a9ebc64b4314e7b238b14448e9/packages/common/interfaces/features/pipe-transform.interface.ts#L30-L45))


```ts
export interface PipeTransform<T = any, R = any> {
  /**
   * Method to implement a custom pipe.  Called with two parameters
   *
   * @param value argument before it is received by route handler method
   * @param metadata contains metadata about the value
   */
  transform(value: T, metadata: ArgumentMetadata): R;
}
```

êµ¬í˜„í•´ì•¼í•˜ëŠ” `transform()` í•¨ìˆ˜ëŠ” ë‘ê°€ì§€ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§„ë‹¤

- `value`: íŒŒì´í”„ì— ì „ë‹¬ëœ ì•„ê·œë¨¼íŠ¸
- `metadata`: í˜„ì¬ íŒŒì´í”„ì— ì „ë‹¬ëœ ì•„ê·œë¨¼íŠ¸ì˜ ë©”íƒ€ë°ì´í„°

ê·¸ë ‡ë‹¤ë©´ `ArgumentMetadata`ëŠ” ì–´ë–»ê²Œ ìƒê²¼ë‚˜? ([ì°¸ê³ ë§í¬](https://github.com/nestjs/nest/blob/e36f04c51eb5c2a9ebc64b4314e7b238b14448e9/packages/common/interfaces/features/pipe-transform.interface.ts#L6-L28))

```ts
/**
 * Interface describing a pipe implementation's `transform()` method metadata argument.
 *
 * @see [Pipes](https://docs.nestjs.com/pipes)
 *
 * @publicApi
 */
export interface ArgumentMetadata {
  /**
   * Indicates whether argument is a body, query, param, or custom parameter
   */
  readonly type: Paramtype;
  readonly metatype?: Type<any> | undefined;
  readonly data?: string | undefined;
}

export type Paramtype = 'body' | 'query' | 'param' | 'custom';
```

- `type`: íŒŒì´í”„ì— ì „ë‹¬ëœ ì¸ìˆ˜ê°€ ë­”ì§€ ì•Œë ¤ì¤Œ. ì»¤ìŠ¤í…€ ë§¤ê°œë³€ìˆ˜ë„ ë°›ì„ ìˆ˜ ìˆìœ¼ë‚˜, ì´ëŠ” 10ì¥ì—ì„œ í›„ìˆ .
- `metatype`: ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì— ì •ì˜ëœ ì•„ê·œë¨¼íŠ¸ íƒ€ì…ì„ ì•Œë ¤ì¤Œ. íƒ€ì…ì„ ìƒëµí•˜ê±°ë‚˜ ë°”ë‹ë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì“°ë©´ `undefined`ê°€ ë¨
- `data`: ë°ì½”ë ˆì´í„°ì— ì „ë‹¬ëœ ë¬¸ìì—´. (ë§¤ê°œë³€ìˆ˜ëª…)

ì˜ˆë¥¼ë“¤ì–´ ì´ëŸ° ë¼ìš°í„° í•¸ë“¤ëŸ¬ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ì.

```ts
@Get(':id')
findOne(@Param('id', ValidationPipe) id: number) {  // [1]
  return this.usersService.findOne(id);
}
```

ì´ ê²½ìš° ë°›ì€ ìš”ì²­ì— ëŒ€í•´, ì•ì„œ ì–¸ê¸‰í•œ `transform` í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ê°’ì€ ì•„ë˜ì™€ ê°™ë‹¤:

- `value`: `1`ë¡œ ë³€ê²½ë¨
- `metadata`: `{ metatype: [Function: Number], type: 'param', data: 'id'}`

## 7.3 ìœ íš¨ì„± ê²€ì‚¬ íŒŒì´í”„ ë§Œë“¤ê¸°

Nest ê³µì‹ë¬¸ì„œì—ì„œëŠ” `@UsePipes` ë°ì½”ë ˆì´í„°ì™€ `joi` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•œ ì»¤ìŠ¤í…€ íŒŒì´í”„ ë°”ì¸ë”© ë°©ì•ˆì´ ìˆë‹¤. [ê³µì‹ë§í¬](https://docs.nestjs.com/pipes#object-schema-validation)

`joi` ëŠ” ìŠ¤í‚¤ë§ˆ ë¼ê³  ë¶€ë¥´ëŠ” ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ì„ ê°€ì§„ ê°ì²´ë¥¼ ë§Œë“¤ê³ , ì´ ìŠ¤í‚¤ë§ˆì— ê²€ì‚¬í•˜ê³ ì í•˜ëŠ” ê°ì²´ë¥¼ ì „ë‹¬í•˜ì—¬ ê²€ì¦(_validate_)í•œë‹¤.

ë‹¤ë§Œ ì €ìëŠ” [`class-validator` ì™€ `class-transformer` ë¥¼ ì‚¬ìš©](https://docs.nestjs.com/techniques/validation#using-the-built-in-validationpipe)í•˜ì—¬ ì‘ì—…í•œë‹¤.

ê¸°ì¡´ì— ë§Œë“  `create-user.dto.ts` ë¥¼ ìˆ˜ì •í•˜ë„ë¡ í•œë‹¤.

> `dto/create-user.dto.ts` ìˆ˜ì •

```ts
import { IsString, MinLength, MaxLength, IsEmail } from 'class-validator';

export class CreateUserDto {
  @IsString()
  @MinLength(1)
  @MaxLength(20)
  readonly name: string;

  @IsEmail()
  readonly email: string;

  readonly password: string;
}
```

> ğŸ… tips
>
> class-validatorì˜ ë‹¤ì–‘í•œ ë°ì½”ë ˆì´í„°ëŠ” [ì´ ë§í¬](https://github.com/typestack/class-validator)ì—ì„œ ì‚´í´ë³´ì.

ê·¸ë ‡ë‹¤ë©´, ìœ„ì™€ê°™ì€ DTOë¥¼ ë°›ê³  ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ëŠ” íŒŒì´í”„(`ValidationPipe`)ë¥¼ êµ¬í˜„í•´ë³¸ë‹¤.

> `src/validation.pipe.ts`

```ts
import {
  PipeTransform,
  Injectable,
  ArgumentMetadata,
  BadRequestException,
} from '@nestjs/common';
import { validate } from 'class-validator';
import { plainToClass } from 'class-transformer';

@Injectable()
export class ValidationPipe implements PipeTransform<any> {
  async transform(value: any, { metatype }: ArgumentMetadata) {
    if (!metatype || !this.toValidate(metatype)) {  // [1] 
      return value;
    }

    const object = plainToClass(metatype, value);   // [2]
    const errors = await validate(object);

    if (errors.length > 0) {
      throw new BadRequestException('Validation Failed');
    }

    return value;                                   // [3]
  }

  private toValidate(metatype: Function): boolean {
    const types: Function[] = [String, Boolean, Number, Array, Object];

    return !types.includes(metatype);
  }
}
```

- í•´ì„¤
  - [1]: `metatype`ì´ íŒŒì´í”„ê°€ ì§€ì›í•˜ëŠ” íƒ€ì…ì¸ì§€ ê²€ì‚¬
  - [2]: `class-transformer` ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `plainToClass`ì„ í˜¸ì¶œí•˜ì—¬, plain objectë¥¼ í´ë˜ìŠ¤ ê°ì²´ë¡œ ë³€í™˜ì‹œí‚¨ë‹¤. ì™œëƒí•˜ë©´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ìœ¼ë¡œ ë“¤ì–´ì˜¨ ê°’ì€ íƒ€ì…ì •ë³´ê°€ ì—†ìœ¼ë©° `class-validator` ìœ íš¨ì„± ê²€ì‚¬ ë°ì½”ë ˆì´í„°ëŠ” íƒ€ì…ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì´ë‹¤
  - [3]: ë³€í™˜ì— ì„±ê³µí•˜ë©´ ê°’ì„ ë¦¬í„´í•œë‹¤

> `src/users/users.controller.ts`

```ts
@Post()
async createUser(@Body(ValidationPipe) dto: CreateUserDto): Promise<void> {
  console.log(dto);
  const { name, email, password } = dto;
  await this.usersService.createUser(name, email, password);
}
```

ì˜ëª»ëœ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤:

```bash
â¯ curl --location 'http://localhost:3000/users' \
--header 'Content-Type: application/json' \
--data-raw '{
    "name": "",
    "email": "s3ich4n@gmail.com",
    "password": "1q2w3e4r"
}'
{"message":"Validation Failed","error":"Bad Request","statusCode":400}
```

`ValidationPipe`ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •í•˜ë ¤ë©´ ë¶€íŠ¸ìŠ¤íŠ¸ë© ê³¼ì •ì— ì ìš©í•œë‹¤.

> ` src/main.ts`

```ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ValidationPipe } from './validation.pipe';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.useGlobalPipes(new ValidationPipe());         // ì´ëŸ° ì‹ìœ¼ë¡œ
  await app.listen(3000);
}
bootstrap();
```

> í•µì‹¬ìš”ì•½: ì›ë¦¬ ì´í•´ì— ì§‘ì¤‘í•˜ì‹œê³ , ì“¸ ë•ŒëŠ” `ValidationPipe` ë¥¼ ì“°ì„¸ìš”

## 7.4 ìœ ì € ì„œë¹„ìŠ¤ì— ìœ íš¨ì„± ê²€ì‚¬ ì ìš©í•˜ê¸°

ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ë©´ "ëª¨ë“ " ìš”ì²­ì´ ì•Œë§ì€ ìš”ì²­ì¼ ë¦¬ê°€ ì—†ë‹¤. ê³µê²©ì„ ë°©ì–´í•´ì•¼í•  ìˆ˜ë„ ìˆê³ , ì˜ëª»ëœ ìš”ì²­ì„ ê±¸ëŸ¬ë‚´ëŠ” ë°©ë²•ë„ í•„ìš”í•˜ë‹¤.

ê·¸ ì¤‘ í•˜ë‚˜ëŠ”, ì˜ëª»ëœ ìš”ì²­ì— ëŒ€í•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ë”°ë¡œí•˜ëŠ” íŒŒì´í”„ë¥¼ ë”°ë¡œ ë‘ì–´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

### 7.4.1 ìœ ì € ìƒì„± ë³¸ë¬¸ì˜ ìœ íš¨ì„± ê²€ì‚¬

ìœ íš¨ì„± ê²€ì‚¬ì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `class-validator` ì™€ `class-transformer` ì´ë‹¤. ì´ ë‘˜ì„ ì„¤ì¹˜í•œë‹¤.

```bash
$ npm i --save class-validator class-transformer
```

ê·¸ë¦¬ê³  ì´ ValidationPipeì€ ì „ì—­ìœ¼ë¡œ ì ìš©í•˜ë„ë¡ í•œë‹¤. ë¶€íŠ¸ìŠ¤íŠ¸ë©ì— `class-transformer` ë¥¼ ì ìš©ì‹œí‚¨ë‹¤. ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤:

```ts
import { NestFactory } from '@nestjs/core';
import { ValidationPipe } from '@nestjs/common';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.useGlobalPipes(
    new ValidationPipe({
      transform: true,
    }),
  );
  await app.listen(3000);
}
bootstrap();
```

ê·¸ë ‡ë‹¤ë©´, ìœ ì € ìƒì„±ì˜ ì œì•½ì‚¬í•­ì„ ì¬ì§€ì •í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì. ì´ ë•Œ `class-validator`ë¥¼ ì‚¬ìš©í•œë‹¤:

- ì‚¬ìš©ì ì´ë¦„
  - 2ì ì´ìƒ 30ì ì´í•˜ì˜ ë¬¸ìì—´
- ì‚¬ìš©ì ì´ë©”ì¼
  - 60ì ì´í•˜ì˜ ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œ
- ì‚¬ìš©ì íŒ¨ìŠ¤ì›Œë“œ
  - ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì ë˜ëŠ” íŠ¹ìˆ˜ë¬¸ìë¡œ ì´ë£¨ì–´ì§„ ë¬¸ìì—´
  - 8ì ì´ìƒ 30ì ì´í•˜

```ts
import {
  IsString,
  MinLength,
  MaxLength,
  IsEmail,
  Matches,
} from 'class-validator';

export class CreateUserDto {
  @IsString()
  @MinLength(2)
  @MaxLength(30)
  readonly name: string;

  @IsEmail()
  @MaxLength(60)
  readonly email: string;

  @IsString()
  @Matches(/^[A-Za-z\d!@#$%^&*()]{8,30}$/)
  readonly password: string;
}
```

### 7.4.2 `class-transformer` ì ìš©

í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `@Transform` ë°ì½”ë ˆì´í„°ì˜ ì •ì˜ë¥¼ ì‚´í´ë³´ì:

> `src/decorators/transform.decorator.ts`

```ts
export function Transform(
  transformFn: (params: TransformFnParams) => any,
  options: TransformOptions = {}
): PropertyDecorator {
  return function (target: any, propertyName: string | Symbol): void {
    defaultMetadataStorage.addTransformMetadata({
      target: target.constructor,
      propertyName: propertyName as string,
      transformFn,
      options,
    });
  };
}
```

ìƒê¸° ë°ì½”ë ˆì´í„°ëŠ” `transformFn`ì„ ì•„ê·œë¨¼íŠ¸ë¡œ ë°›ëŠ”ë‹¤. ì´ í•¨ìˆ˜ëŠ” ë°ì½”ë ˆì´í„° ì ìš© í›„ ì†ì„±ì˜ ê°’(`value`)ê³¼ ê·¸ ì†ì„±ì„ ê°€ì§„ ê°ì²´(`obj`) ë“±ì„ ì•„ê·œë¨¼íŠ¸ë¡œ ë°›ì•„ ì†ì„± ë³€í˜• í›„ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

ê·¸ë ‡ë‹¤ë©´ `TransformFnParams`ì— ì–´ë–¤ ê°’ì´ ë‹´ê¸°ëŠ”ì§€ DTOì— `console.log()` ë¥¼ í˜¸ì¶œí•˜ì—¬ ë””ë²„ê¹…í•´ë³´ì:

```bash
â¯ curl --location 'http://localhost:3000/users' \
--header 'Content-Type: application/json' \
--data-raw '{
    "name": "s3ich4n",
    "email": "s3ich4n@gmail.com",
    "password": "1q2w3e4r"
}'
```

ì•„ë˜ì™€ ê°™ì€ ê°’ì´ ë‹´ê²¨ìˆë‹¤.

```javascript
{
  value: 's3ich4n',
  key: 'name',
  obj: { name: 's3ich4n', email: 's3ich4n@gmail.com', password: '1q2w3e4r' },
  type: 0,
  options: {
    enableCircularCheck: false,
    enableImplicitConversion: false,
    excludeExtraneousValues: false,
    excludePrefixes: undefined,
    exposeDefaultValues: false,
    exposeUnsetFields: true,
    groups: undefined,
    ignoreDecorators: false,
    strategy: undefined,
    targetMaps: undefined,
    version: undefined
  }
}
```

ë‹´ê¸´ ê°’ì˜ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤:

> `src/interfaces/metadata/transform-fn-params.interface.ts`

```ts
export interface TransformFnParams {
  value: any;
  key: string;
  obj: any;
  type: TransformationType;
  options: ClassTransformOptions;
}
```

ìœ ì €ìƒì„±ì¤‘ `name`ì˜ ì•ë’¤ì— ê³µë°±ë¬¸ìë¥¼ í¬í•¨í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤ê³  ê°€ì •í•œë‹¤ë©´, `trim()` ë©”ì†Œë“œë¡œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.

```ts
@Transform(params => params.value.trim())
@IsString()
@MinLength(2)
@MaxLength(30)
readonly name: string;
```

> â€¼ ì£¼ì˜!
>
> `trim()` ë©”ì†Œë“œê°€ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ê³µë°±ì´ ìˆë‹¤(ê³µë°±ì²˜ëŸ¼ ë³´ì´ëŠ” ìœ ë‹ˆì½”ë“œ ë¬¸ì ë“±)
>
> ì´ëŸ° ë¶€ë¶„ì€ í•„ìš”ì— ë”°ë¼ ì„ì˜ë¡œ ì²˜ë¦¬í•´ì£¼ì–´ì•¼ í•œë‹¤.

`TransformFnParams`ì—ëŠ” `obj`ë¼ëŠ” ì†ì„±ì´ ìˆì—ˆë‹¤. ì´ëŠ” í˜„ì¬ ì†ì„±ì´ ì†í•´ìˆëŠ” ê°ì²´ë¥¼ ê°€ë¦¬í‚¨ë‹¤. ì´ ì˜ˆì‹œì—ì„œëŠ” `CreateUserDto` ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤. `obj`ì˜ ë‹¤ë¥¸ ì†ì„±ê°’ì— ë”°ë¼ êµ¬í˜„ì„ ë‹¤ë¥´ê²Œ í•  ìˆ˜ë„ ìˆë‹¤.

E.g., `password`ëŠ” `name`ê³¼ **ë™ì¼í•œ** ë¬¸ìì—´ì„ í¬í•¨í•  ìˆ˜ ì—†ë„ë¡ í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•œë‹¤:

```ts
@Transform(({ value, obj }) => {
  if (obj.password.includes(obj.name.trim())) {   // ì´ëŸ° ì‹ìœ¼ë¡œ ë¹„êµ
    throw new BadRequestException("password should not contain name.")
  }
  return value.trim();
})
@IsEmail()
@MaxLength(60)
readonly email: string;
```

### 7.4.3 ì»¤ìŠ¤í…€ ìœ íš¨ì„± ê²€ì‚¬ê¸° ì‘ì„±

`@Transform` ì„ ì»¤ìŠ¤í…€í•˜ì—¬ í•„ìš”í•œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ë ¤ë©´ `class-validator`ì˜ ë°ì½”ë ˆì´í„°ë¥¼ í•„ìš”ì— ë”°ë¼ ë°”ê¾¼ë‹¤.

> `src/utils/decorators/not-in.ts`

```ts
import {
  registerDecorator,
  ValidationOptions,
  ValidationArguments,
  ValidatorConstraint,
  ValidatorConstraintInterface,
} from 'class-validator';

export function NotIn(
  property: string,
  validationOptions?: ValidationOptions,
) {                                                                         // [1]
  return (object: Object, propertyName: string) => {                        // [2]
    registerDecorator({                                                     // [3]
      name: 'NotIn',                                                        // [4]
      target: object.constructor,                                           // [5]
      propertyName,
      options: validationOptions,                                           // [6]
      constraints: [property],                                              // [7]
      validator: {                                                          // [8]
        validate(value: any, args: ValidationArguments) {
          const [relatedPropertyName] = args.constraints;
          const relatedValue = (args.object as any)[relatedPropertyName];
          return typeof value === 'string'
            && typeof relatedValue === 'string'
            && !relatedValue.includes(value);
        }
      }
    })
  }
}
```

- ì„¤ëª…
  - [1]: ë°ì½”ë ˆì´í„°ì˜ ì•„ê·œë¨¼íŠ¸: ê°ì²´ì—ì„œ ì°¸ì¡°í•˜ë ¤í•˜ëŠ” ë‹¤ë¥¸ ì†ì„±ëª…(`property`), `ValidationOptions`
  - [2]: `registerDecorator`ë¥¼ í˜¸ì¶œí•˜ëŠ” ë©”ì†Œë“œë¥¼ ë¦¬í„´. í•´ë‹¹ ê°’ì˜ ì•„ê·œë¨¼íŠ¸ -> ë°ì½”ë ˆì´í„°ê°€ ì„ ì–¸ë  ê°ì²´ì™€ ì†ì„±ëª…
  - [3]: `registerDecorator`ëŠ” `ValidationOptions` ê°ì²´ë¥¼ ì•„ê·œë¨¼íŠ¸ë¡œ ë°›ìŒ
  - [4]: ë°ì½”ë ˆì´í„° ì´ë¦„ì„ `NotIn`ìœ¼ë¡œ ì§€ì •
  - [5]: ì´ ë°ì½”ë ˆì´í„°ëŠ” ê°ì²´ ìƒì„± ì‹œ ì ìš©ë  ê²ƒì„
  - [6]: ìœ íš¨ì„± ì˜µì…˜ì€ ë°ì½”ë ˆì´í„°ì˜ ì•„ê·œë¨¼íŠ¸ë¡œ ë°›ì€ ê°’ì„ ì‚¬ìš©í•¨
  - [7]: ì´ ë°ì½”ë ˆì´í„°ëŠ” ì†ì„±ì— ì ìš©ë˜ë„ë¡ ì œì•½ì„ ì§€ì •
  - [8]: ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” ë¡œì§. `validator` ì†ì„±ì— ê¸°ìˆ ë¨. `ValidatorConstraintInterface`ë¥¼ êµ¬í˜„í•œ ë©”ì†Œë“œ

ì´ ìƒíƒœì—ì„œ ìš”ì²­ì„ í…ŒìŠ¤íŠ¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì˜ ë™ì‘í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.

```bash
â¯ curl --location 'http://192.168.219.102:3000/users' \
--header 'Content-Type: application/json' \
--data-raw '{
    "name": "s3ich4n",
    "email": "s3ich4n@gmail.com",
    "password": "s3ich4n"
}'
{"message":"password should not contain name.","error":"Bad Request","statusCode":400}
```

## ì¸ì¦ê³¼ ì¸ê°€

- ì¸ì¦ - ë‹¹ì‹ ì´ ëˆ„êµ¬ì¸ì§€ ì¦ëª…í•˜ì‹œì˜¤
- ì¸ê°€ - ë‹¹ì‹ ì´ ë¬´ì—‡ì„ í•  ìˆ˜ ìˆëŠ”ì§€ ì¦ëª…í•˜ì‹œì˜¤
- ì¸ì¦ì€ ì¸ê°€ ì˜ì‚¬ê²°ì •ì˜ í•œ ìš”ì†Œê°€ ë  ìˆ˜ ìˆìŒ
- ì¸ê°€ì— ì“°ì´ëŠ” ë„êµ¬(í† í°)ìœ¼ë¡œ ìœ ì‚¬-ì¸ì¦ì„ í•˜ëŠ” ê²ƒì€ ìœ ìš©í•˜ì§€ ì•ŠìŒ